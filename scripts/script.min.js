/*! sheep-subreddits 01-12-2017 */

function filterDomains(a){var b=[];for(i=0;i<a.length;i++)for(j=0;j<IMAGE_DOMAINS.length;j++)if(a[i].data.domain===IMAGE_DOMAINS[j]&&(a[i].data.url.endsWith(".jpg")||a[i].data.url.endsWith(".jpeg")||a[i].data.url.endsWith(".png"))){b.push(a[i]);continue}return b}function filterNsfw(a){var b=[];for(i=0;i<a.length;i++)if(!a[i].data.over_18){b.push(a[i]);continue}return b}function init(){document.onkeydown=function(a){"Enter"===a.key&&guess()},getContent()}function getContent(){guessed=!1,promise=fetchContent(SUBREDDITS[Math.floor(Math.random()*SUBREDDITS.length)]).then(function(a){LISTING=a.data.children},function(a){console.log(a)}),huh=[],huh.push(promise),Promise.all(huh).then(function(){LISTING=filterDomains(LISTING),LISTING=filterNsfw(LISTING),0!=LISTING.length?(picked=Math.floor(Math.random()*LISTING.length),pickedData=LISTING[picked].data,document.getElementById("image").innerHTML='<img src="'+pickedData.url+'" style="max-width:100%;max-height:100%;display: inline-block;vertical-align: middle"/>',IMAGE_ID=pickedData.id,setContent()):(guessed=!0,document.getElementById("image").innerHTML="<error>Please Refresh or disable tracking protection</error>",setTimeout(function(){getContent()},2e3))})}function setContent(){duplicatePromise=fetchDuplicates(IMAGE_ID).then(function(a){DUPLICATE_LISTING=a[0].data.children.concat(a[1].data.children),console.log(DUPLICATE_LISTING)},function(a){console.log(a)}),huh=[],huh.push(duplicatePromise),Promise.all(huh).then(function(){for(items=[],i=0;i<DUPLICATE_LISTING.length;i++)DUPLICATE_LISTING[i].data.score>100&&items.push(DUPLICATE_LISTING[i].data.subreddit),document.getElementById("answers").innerHTML="";0==items.length&&(guessed=!0,document.getElementById("image").innerHTML="<error>Please Refresh</error>",setTimeout(function(){getContent()},2e3))})}function guess(){if(guessed)return void(document.getElementById("guess").value="");for(input=document.getElementById("guess").value,i=0;i<items.length;i++){if(items[i].toUpperCase()===input.toUpperCase()&&!guessed){document.getElementById("answers").innerHTML='<a style="color:green" target="_blank" href="https://www.reddit.com/r/'+items[i]+'/">/r/'+items[i]+"</a>",guessed=!0,score++,strike_count=0,document.getElementById("score").innerHTML="Score: "+score;break}i==items.length-1&&(strike_count++,4==strike_count&&(strike_count=0,guessed=!0,document.getElementById("answers").innerHTML='<span style="color:red">Wrong! Answer is /r/'+items[0]+"</span>"),document.getElementById("answers").innerHTML='<span style="color:red">Wrong! ('+(4-strike_count)+" tries left)</span>")}document.getElementById("guess").value="",guessed&&setTimeout(function(){getContent()},2e3)}function fetchContent(a){return url="https://www.reddit.com/r/",url=url.concat(a,"/top.json?sort=top&t=month"),fetch(url).then(function(a){if(a.status>=400)throw new Error("Bad response in fetchContent");return a.json()})}function fetchDuplicates(a){return url="https://www.reddit.com/duplicates/",url=url.concat(a,".json"),fetch(url).then(function(a){if(a.status>=400)throw new Error("Bad response in fetchContent");return a.json()})}var IMAGE_DOMAINS=["i.redd.it","i.imgur.com"],items=[],guessed=!0,score=0,LISTING={},DUPLICATE_LISTING={},IMAGE_ID=0,strike_count=0,disabled=!0,SUBREDDITS=["woahdude","aww","nevertellmetheodds","mildlyinteresting","iamverysmart","2meirl4meirl","insanepeoplefacebook","therewasanattempt","mildlyinfuriating","coaxedintoasnafu","madlads","crappydesign","thisismylifenow","youdontsurf","cringepics","iamverybadass","quityourbullshit","oopsdidntmeanto","comedycemetery","deepfriedmemes","murderedbywords","oldpeoplefacebook","indianpeoplefacebook","wholesomememes","justneckbeardthings","dontdeadopeninside","thathappened","maliciouscompliance","hmmm","atbge","bonehurtingjuice","sbubby","fellowkids","im14andthisisdeep","dataisbeautiful","oldschoolcool","forwardsfromgrandma","perfecttiming","notmyjob","boottoobig","niceguys","evilbuildings"];